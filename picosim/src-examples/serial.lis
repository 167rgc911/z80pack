Z80/8080-Macro-Assembler  Release 2.0	Thu Apr 25 20:15:55 2024

LOC   OBJECT CODE   LINE   STMT SOURCE CODE
                       1      1 ;
                       2      2 ; Example program for the Pico Z80
                       3      3 ; Do some serial I/O.
                       4      4 ;
                       5      5 ; Udo Munk, April 2024
                       6      6 ;
                       7      7 	ORG	0000H			; starting at memory location 0
                       8      8 
000d  =                9      9 CR	EQU	13			; carriage return
000a  =               10     10 LF	EQU	10			; line feed
                      11     11 
0000  =               12     12 TTYSTA	EQU	0			; tty status port
0001  =               13     13 TTYDAT	EQU	1			; tty data port
                      14     14 
0000  31 00 f0        15     15 	LD	SP,0F000H		; setup stack in upper memory
0003  21 17 00        16     16 	LD	HL,TEXT			; load HL with text to send
0006  7e              17     17 LOOP:	LD	A,(HL)			; get next character
0007  b7              18     18 	OR	A			; is it 0 termination?
0008  28 0c           19     19 	JR	Z,DONE			; if yes done
000a  f5              20     20 	PUSH	AF			; save character in A
000b  db 00           21     21 LOOP1:	IN	A,(TTYSTA)		; get tty status
000d  07              22     22 	RLCA
000e  38 fb           23     23 	JR	C,LOOP1			; wait if not ready
0010  f1              24     24 	POP	AF			; get back character into A
0011  d3 01           25     25 	OUT	(TTYDAT),A		; output it to tty port
0013  23              26     26 	INC	HL			; point to next character
0014  18 f0           27     27 	JR	LOOP			; and again
0016  76              28     28 DONE:	HALT				; done
                      29     29 
0017  48 65 6c 6c     30     30 TEXT:	DEFM	"Hello from the Z80 CPU"
001b  6f 20 66 72     30     31
001f  6f 6d 20 74     30     32
0023  68 65 20 5a     30     33
0027  38 30 20 43     30     34
002b  50 55           30     35
002d  0d 0a 00        31     36 	DEFB	CR,LF,0
                      32     37 
0030                  33     38 	END
