Z80/8080-Macro-Assembler  Release 2.0

LOC   OBJECT CODE   LINE   STMT SOURCE CODE
                       1      1 ;
                       2      2 ;	boot ROM for z80pack machines using SD-FDC
                       3      3 ;	use 8080 instructions only, so that it runs
                       4      4 ;	on all our CPU's
                       5      5 ;
                       6      6 ;	Copyright (C) 2024 by Udo Munk
                       7      7 ;
                       8      8 	ORG	0FF80H		;ROM in upper most memory page
                       9      9 ;
                      10     10 ;	I/O ports
                      11     11 ;
0004  =               12     12 FDC	EQU	4		;FDC port
                      13     13 ;
ff00  =               14     14 FDCMD	EQU	0FF00H		;command bytes for the FDC
                      15     15 ;
ff80  f3              16     16 	DI			;disable interrupts
                      17     17 ;
ff81  af              18     18 	XOR	A		;zero A
ff82  32 00 ff        19     19 	LD	(FDCMD),A	;track 0 
ff85  32 02 ff        20     20 	LD	(FDCMD+2),A	;DMA address low
ff88  32 03 ff        21     21 	LD	(FDCMD+3),A	;DMA address high
ff8b  3e 01           22     22 	LD	A,1		;sector 1
ff8d  32 01 ff        23     23 	LD	(FDCMD+1),A
                      24     24 ;
ff90  3e 10           25     25 	LD	A,10H		;setup command for FDC
ff92  d3 04           26     26 	OUT	(FDC),A
ff94  3e 00           27     27 	LD	A,FDCMD AND 0FFH
ff96  d3 04           28     28 	OUT	(FDC),A
ff98  3e ff           29     29 	LD	A,FDCMD SHR 8
ff9a  d3 04           30     30 	OUT	(FDC),A
                      31     31 ;
ff9c  3e 20           32     32 	LD	A,20H		;read sector 1 on track 0 from drive 0
ff9e  d3 04           33     33 	OUT	(FDC),A
ffa0  db 04           34     34 	IN	A,(FDC)		;get FDC result
ffa2  b7              35     35 	OR	A		;zero ?
ffa3  ca 00 00        36     36 	JP	Z,0		;if yes jump to boot code loaded @ 0
                      37     37 ;
ffa6  76              38     38 	HALT			;some problem, reason still in A
                      39     39 ;
ffa7                  40     40 	END			;of ROM

Symbol table

FDC   0004    FDCMD ff00    
